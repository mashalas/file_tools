# fresh_files_processor
## Обработчик свежих файлов
Для новых файлов в заданном каталоге (каталогах) выполнить команды операционной системы.

Все параметры задаются в конфигурационном файле. Скрипту как в качестве аргументов командной строки передаётся один или несколько конфигурационных файлов. Пример конфигурационного файла:
```
dir=./files
mask=*.txt
processed=processed.log
dir=another_files
sort_by=mtime
sort_reverse=true
only_newer=2025-06-24 04:01:02
skip_newer=2025-07-25

<prior_commands>
</prior_commands>

<commands>
  md5sum ${longname} > ${longname}.md5
  echo size: ${filesize} >> ${longname}
</commands>

<post_commands>
</post_commands>
```
При передаче этого конфигурационного файла будут выполнены следующие действия:
1. Просканировать каталоги "./files" и "another_files" на предмет наличия в них файлов с расширением txt
2. В обработку принимаются только те файлы, дата модификации которых больше 2025-06-24 04:01:02 и меньше 2025-07-25 00:00:00
3. Полученный из обоих каталогов список файлов отсортировать по дате модификации (sort_by=mtime) в обратном порядке (sort_reverse=true). 
4. Из файла processed.log будет получен список файлов, которые уже обрабатывались ранее. Для обработанных ранее файлов никаких действий не выполняется. Если параметр processed конфигурационного файла не содержит имени файла или отсутствует в конфигурационном файле - действия будут выполняться кажый раз для всех найденных файлов.
5. До выполнения команд для каждого файла, выполнить команды из блока <prior_commands>
6. Для каждого файла выполнить команды из блока <commands>. В командах можно использовать переменные. Описание переменных далее.
7. После выполнения команд для всех файлов, выполнить команды из блока <post_commands>

Команды могут содержать переменные вида ${name}, где name - имя переменной. Вместо ${name} будет подставляться значение этой переменной.
Имена переменных и критерии сортировки:
   * ctime = время создания файла
   * mtime = время изменения файлу
   * atime = время доступа к файлу
   * shortname = короткое имя файла без имени каталога
   * longname = длинное имя файла с именем каталога
   * filesize = размер файла
   * filetime = время изменения файла в формате %Y-%m-%d %H:%M:%S
 

Если параметр processed указан и содержит не пустое значение, то в файл с именем указанным в параметре processed будут записаны время обработки файла и его "длинное имя" разделённые символом табуляции.
При следующем запуске не будут выполняться команды для файлов перечисленных в файле заданном параметром processed.
